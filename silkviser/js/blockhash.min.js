$(function(){function t(t){$.ajax({type:"get",async:!0,url:t,success:function(t){$("#s_lastestheight").html(t.height),$("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show()},error:function(t){console.log(t.statusText)}})}function e(t){$("#blockdetailTable").mask(),$("#coin_glyph").mask(),$("#coin_filter").mask(),$("#txlistTable").mask(),$.ajax({type:"get",async:!0,url:t,success:function(t){t.height>1e4&&t.txs.shift(),$(".moreshow").addClass("tt");var e=!0;$("#optionsRadios1").on("click",function(){e?($(".moreshow").removeClass("tt"),e=!1):($(".moreshow").addClass("tt"),e=!0)}),Z=t.max_txsize,tt=t.max_vin_count,et=t.max_vout_count,console.log(t);var i=Math.max.apply(Math,t.txs.map(function(t){return t.vin_count})),l=Math.min.apply(Math,t.txs.map(function(t){return t.vin_count})),c=Math.max.apply(Math,t.txs.map(function(t){return t.vout_count})),d=Math.min.apply(Math,t.txs.map(function(t){return t.vout_count}));Y=Math.max.apply(Math,t.txs.map(function(t){return t.txfee})),N=Math.max(i,c),Math.min(l,d);Math.max(tt,et);at=d3.scaleLinear().domain([1,1.5*N]).range([.02*Math.PI,Math.PI]),nt=d3.scaleLinear().domain([0,Y]).range([.5,1]),a(t),n(t),$("#blockdetailTable").unmask(),$("#listTableDiv").hide(),o(t),$("#coin_filter").unmask(),s(t.txs),$("#coin_glyph").unmask(),$("#listTableDiv2").hide(),r(t.txs),$("#txlistTable").unmask(),$("#listTableDiv3").hide(),B=t},error:function(t){console.error(t.statusText)}})}function a(t){$("#block").text(t.height),$("#blockheight").text(t.height),$("#previousblockhash").attr("href","/block/blockhash.html?hash="+t.previousblockhash),$("#nextblockhash").attr("href","/block/blockhash.html?hash="+t.nextblockhash),$("#blockhash").text(t.hash),$("#blocktime").text(cnen_timeformater(t.time)),$("#blockminedby").text(t.miner),$("#blockreward").text(t.reward+" SLU"),$("#blocktxsfee").text(t.txfee_sum+" SLU"),$("#blocksize").text(t.size+" bytes"),$("#blockversion").text(parseInt(t.version).toString(16)),$("#blockconfirmations").text(t.confirmations)}function n(t){L.append("g").append("rect").attr("class","barbgclass").attr("width",.8*left_svg_w).attr("height",.8*left_svg_h).attr("transform","translate(0,0)").attr("fill-opacity",.2);L.append("text").attr("text-anchor","middle").attr("x","50%").attr("y",2*b.left).style("font-size",R).attr("class","blocktext2").text($.i18n.prop("current_trans")),Q=L.append("text").attr("text-anchor","middle").attr("x","50%").attr("y",4*b.left).style("font-size",1.7*R).attr("class","blocktext1").text("")}function r(t){$("#txlistTable").bootstrapTable("destroy"),$("#txlistTable").bootstrapTable({data:t,pagination:!0,sortable:!0,columns:[{field:"txid",title:$.i18n.prop("bt-txid"),align:"center",formatter:function(t,e,a){var n="<a href='/transaction/txid.html?txid="+t+"'>"+t+"</a>";return n}},{field:"vin_count",title:$.i18n.prop("bt-vin_count"),align:"center",sortable:!0},{field:"vout_count",title:$.i18n.prop("bt-vout_count"),align:"center",sortable:!0},{field:"size",title:$.i18n.prop("bt-size"),align:"center",sortable:!0},{field:"txfee",title:$.i18n.prop("bt-txfee"),align:"center",sortable:!0}],onSort:function(e,a){$("#coin_filter").mask(),s(t,e,a),$("#coin_filter").unmask()}})}function s(t,e,a){Q.text(t.length);var n=t;e&&(n="asc"==a?t.sort(function(t,a){return t[e]-a[e]}):t.sort(function(t,a){return a[e]-t[e]}));var r=A;d3.select(".mainClass").remove();var s=C.append("g").attr("class","mainClass").attr("id","mainsvg"),l=.65*r,o=.5*l,c=d3.scaleLinear().range([.2*.8*o,.8*.8*o]).domain([0,Z]),d=t.length,x={outerRadius:o,innerRadius:.8*o,x:0,y:.5*left_svg_h*.8},p=T,h=p/l,f=1,u=0;u=Math.floor(h-4);var g=0,m=0;d>u?(f=2,g=(p-(u+1.4)*l)/u):(f=1,u=d,g=p/u,g>o&&(g=o,m=(p-(u*l+(u+1)*o))/2));for(let t=0;t<u;t++)x.x=m+t*(l+g)+2*o,i(s,x,Z,n[t],t,c);if(2==f)for(var y=0;y<6;y++)s.append("g").append("circle").attr("class","coin_circle").attr("cx",function(t){return m+u*(l+g)+1.1*o+y*l/7}).attr("cy",function(t){return x.y}).attr("r",1).attr("fill","grey");var v=s.append("g").attr("class","tips").attr("id","tipsbox").style("display","none");v.append("rect").attr("class","tips-border").attr("width",.18*k).attr("height",.26*_).attr("rx",10).attr("ry",10),v.append("text").attr("id","tipstext1").attr("class","tips-text blocktextblack").attr("x",.8*R).attr("y",.05*_).text("").style("font-size",R),v.append("text").attr("id","tipstext2").attr("class","tips-text blocktextblack").attr("x",.8*R).attr("y",.09*_).text("").style("font-size",R),v.append("text").attr("id","tipstext3").attr("class","tips-text blocktextblack").attr("x",.8*R).attr("y",.14*_).text("").style("font-size",R),v.append("text").attr("id","tipstext4").attr("class","tips-text blocktextblack").attr("x",.8*R).attr("y",.19*_).text("").style("font-size",R),v.append("text").attr("id","tipstext5").attr("class","tips-text blocktextblack").attr("x",.8*R).attr("y",.23*_).text("").style("font-size",R)}function i(t,e,a,n,r,s){e.x,e.y;var i=[];i.push(n);var o=t.append("g").selectAll("ring"+r).data(i).enter().append("g").attr("class","ring"+r);o.attr("id","coin"+r).attr("transform","translate("+e.x+","+e.y+")").on("mouseover",l).on("mouseout",function(){d3.select("#tipsbox").style("display","none")}).on("click",function(){top.location.href="/transaction/txid.html?"+$.param({txid:n.txid,addrsScale_max:N})});var c=d3.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(e.innerRadius).outerRadius(e.outerRadius);o.append("path").attr("d",c).style("fill","white").style("stroke","#ae7c4b").attr("stroke-width","1px");var d=o.append("g").attr("class","ring_2");d.append("circle").attr("r",e.innerRadius).style("fill","#e9c598").attr("opacity",function(t,e){return nt(n.txfee)}),d.append("text").attr("text-anchor","middle").attr("class","blocktext1").attr("x",-.5*e.innerRadius).attr("y",.25*e.innerRadius-.25*R).text("T").style("font-size",R).attr("opacity",.5),d.append("text").attr("text-anchor","middle").attr("class","blocktext1").attr("x",.5*e.innerRadius).attr("y",.25*e.innerRadius-.25*R).text("X").style("font-size",R).attr("opacity",.5);var x=10*n.size/a;x=Math.ceil(x),x<1&&(x=1);var p=d3.arc().startAngle(-.5*Math.PI+at(n.vin_count/2)).endAngle(function(){return-at(n.vin_count/2)-.5*Math.PI}).innerRadius(e.innerRadius+.6).outerRadius(e.outerRadius-.3),h=d3.arc().startAngle(.5*Math.PI-at(n.vout_count/2)).endAngle(function(){return at(n.vout_count/2)+.5*Math.PI}).innerRadius(e.innerRadius+.6).outerRadius(e.outerRadius-.3);o.append("path").attr("d",p).style("fill","#b2d9ed"),o.append("path").attr("d",h).style("fill","#b2d9ed"),d.append("rect").attr("x",-.5).attr("y",-e.innerRadius).attr("height",2*e.innerRadius).attr("width",1).style("fill","#ae7c4b").style("opacity","0.3");var f=d.append("g").attr("class","rect");f.append("rect").attr("x",function(t,e){return-.5*s(n.size)}).attr("y",function(t,e){return-.5*s(n.size)}).attr("width",function(t,e){return s(n.size)}).attr("height",function(t,e){return s(n.size)}).attr("fill","white").style("stroke","#ae7c4b").style("stroke-width",.8)}function l(t){function e(t){return t.replace(/(^\s*)|(\s*$)/g,"")}var a=$(this).css("transform").split("(")[1].split(")")[0].split(",")[4],n=$(this).css("transform").split("(")[1].split(")")[0].split(",")[5];try{d3.select("#tipstext1").text($.i18n.prop("bt-txid")+": "+e(t.txid).substring(0,5)+"..."+e(t.txid).substring(59,64)),d3.select("#tipstext2").text($.i18n.prop("bt-vin_count")+": "+t.vin_count),d3.select("#tipstext3").text($.i18n.prop("bt-vout_count")+": "+t.vout_count),d3.select("#tipstext4").text($.i18n.prop("bt-txfee")+": "+t.txfee+" SLU"),d3.select("#tipstext5").text($.i18n.prop("bt-size")+": "+t.size+" bytes"),d3.select("#tipsbox").attr("transform","translate("+a+","+(n-30)+")").style("display","block")}catch(t){console.log(t)}}function o(t){ot={x:2*b.left,y:.4*_-b.top,w:.28*k},ct={h:.4*_-2*b.top-b.bottom,x:2*b.left,y:2*b.top},c(t.txs),x(t.txs),p(t.txs)}function c(t){function e(t){var e="Range: "+t.x0+"~"+t.x1+", ";e=e+"Value: "+t.length,$(this).attr("x")>ot.x+.5*ot.w?n.append("g").attr("id","rectbar").append("text").text(e).attr("x",$(this).attr("x")-.32*ot.w).attr("y",$(this).attr("y")-2).style("font-size",.7*R).style("display","inline-block"):n.append("g").attr("id","rectbar").append("text").text(e).attr("x",$(this).attr("x")).attr("y",$(this).attr("y")-2).style("font-size",.7*R).style("display","inline-block")}function a(){try{if(!d3.event.selection)return void(s&&(s=!1,d()));s=!0;var t=d3.event.selection;if(t){var e=[],a=Math.min(t[0],t[1])-ot.x,n=Math.max(t[0],t[1])-ot.x;dt.forEach(t=>{var r=t.x0;S(r)>=a&&S(r)<=n&&e.push(t)}),e.length>0?(ht=[],e.forEach(t=>{ht=ht.concat(t)})):ht=[]}}catch(t){ht=[]}ht.length>0?(ft=[],x(ht),ut=[],p(ht)):d(),h()}d3.select(".filterClass1").remove();var n=j.append("g").attr("class","filterClass1").attr("id","filtersvg");H=d3.max(t,function(t){return t.vin_count+t.vout_count}),1==gt&&(rt=H),gt=!1,S=d3.scaleLinear().domain([0,rt+rt/5]).range([0,ot.w]);var r=d3.axisBottom(S).ticks(5);F=d3.histogram().domain(S.domain()).thresholds(S.ticks(25)).value(function(t){return t.vin_count+t.vout_count}),dt=F(t).filter(t=>t.length>0),n.append("g").attr("class","axis xAxis").attr("transform","translate("+ot.x+","+ot.y+")").call(r).style("font-size",.6*R+"px").selectAll("text"),n.append("text").attr("text-anchor","end").attr("transform","translate("+(ot.w+ot.x)+","+(ot.y+2*b.top)+")rotate(0)").text($.i18n.prop("axis-x1")).style("font-size",.9*R+"px"),O=d3.max(dt,function(t){return t.length}),D=d3.scaleLinear().domain([O,0]).range([0,ct.h]);var s,i=d3.axisLeft(D).ticks(3);n.append("g").attr("class","axis xAxis").attr("transform","translate("+ct.x+","+ct.y+")").call(i).style("font-size",.6*R+"px"),n.append("text").attr("transform","translate("+(ct.x-20)+","+(ct.y-15)+")rotate(0)").text($.i18n.prop("axis-txs")).style("font-size",.9*R+"px");n.append("g").data(dt).attr("class","brush").call(d3.brushX().on("end",a));M=.005*k,n.append("g").selectAll("rect").data(dt).enter().append("rect").attr("x",t=>S(t.x0)+ct.x+1).attr("width",t=>M).attr("y",t=>D(t.length)+ct.y).attr("height",t=>D(0)-D(t.length)).attr("fill","#d6b58e").attr("value",t=>t.length).attr("fill-opacity",.9).on("mouseover",e).on("mouseout",function(){$("#rectbar").remove()})}function d(){ht=[],ft=[],ut=[],h(),c(B.txs),x(B.txs),p(B.txs)}function x(t){function e(t){var e="Range: "+t.x0+"~"+t.x1+", ";e=e+"Value: "+t.length,$(this).attr("x")>.5*ot.w+ot.x?n.append("g").attr("id","rectbar2").append("text").text(e).attr("x",$(this).attr("x")-.45*ot.w).attr("y",$(this).attr("y")-2).style("font-size",.7*R).style("display","block"):n.append("g").attr("id","rectbar2").append("text").text(e).attr("x",$(this).attr("x")).attr("y",$(this).attr("y")-2).style("font-size",.7*R).style("display","block")}function a(){try{if(!d3.event.selection)return void(l&&(l=!1,d()));l=!0;var t=d3.event.selection;if(t){var e=[],a=Math.min(t[0],t[1])-ot.x,n=Math.max(t[0],t[1])-ot.x;xt.forEach(t=>{var r=t.x0;E(r)>=a&&E(r)<=n&&e.push(t)}),e.length>0?(ft=[],e.forEach(t=>{ft=ft.concat(t)})):ft=[]}}catch(t){ft=[]}ft.length>0?(ht=[],c(ft),ut=[],p(ft)):d(),h()}d3.select(".filterClass2").remove();var n=I.append("g").attr("class","filterClass2").attr("id","filtersvg2"),r=d3.max(t,function(t){return 1e3*t.txfee}),s=d3.min(t,function(t){return 1e3*t.txfee});1==mt&&(st=s,it=r),mt=!1,E=d3.scaleLinear().domain([st,it]).range([0,ot.w]);var i=d3.axisBottom(E).ticks(5);J=d3.histogram().domain(E.domain()).thresholds(E.ticks(25)).value(function(t){return 1e3*t.txfee}),xt=J(t).filter(t=>t.length>0),n.append("g").attr("class","axis xAxis").attr("transform","translate("+ot.x+","+ot.y+")").call(i).style("font-size",.6*R+"px").selectAll("text"),n.append("text").attr("text-anchor","end").attr("transform","translate("+(ot.w+1.12*ot.x)+","+(ot.y+2*b.top)+")rotate(0)").text($.i18n.prop("axis-x3")).style("font-size",.9*R+"px"),W=d3.max(xt,function(t){return t.length}),X=d3.scaleLinear().domain([W,0]).range([0,ct.h]);var l,o=d3.axisLeft(X).ticks(3);n.append("g").attr("class","axis xAxis").attr("transform","translate("+ct.x+","+ct.y+")").call(o).style("font-size",.6*R+"px"),n.append("text").attr("transform","translate("+(ct.x-23)+","+(ct.y-15)+")rotate(0)").text($.i18n.prop("axis-txs")).style("font-size",.9*R+"px");n.append("g").data(xt).attr("class","brush").call(d3.brushX().on("end",a));n.append("g").attr("fill","#d6b58e").selectAll("rect").data(xt).join("rect").attr("x",t=>E(t.x0)+ct.x).attr("width",t=>M).attr("y",t=>X(t.length)+ct.y).attr("height",t=>X(0)-X(t.length)).attr("fill-opacity",.9).text(t=>t.length).attr("value",t=>t.length).on("mouseover",e).on("mouseout",function(){$("#rectbar2").remove()})}function p(t){function e(t){var e="Range: "+t.x0+"~"+t.x1+", ";e=e+"Value: "+t.length,$(this).attr("x")>.5*ot.w+ot.x?n.append("g").attr("id","rectbar3").append("text").text(e).attr("x",$(this).attr("x")-.4*ot.w).attr("y",$(this).attr("y")-2).style("font-size",.7*R).style("display","block"):n.append("g").attr("id","rectbar3").append("text").text(e).attr("x",$(this).attr("x")).attr("y",$(this).attr("y")-2).style("font-size",.7*R).style("display","block")}function a(){try{if(!d3.event.selection)return void(s&&(s=!1,d()));s=!0;var t=d3.event.selection;if(t){var e=[],a=Math.min(t[0],t[1])-ot.x,n=Math.max(t[0],t[1])-ot.x;pt.forEach(t=>{var r=t.x0;U(r)>=a&&U(r)<=n&&e.push(t)}),e.length>0?(ut=[],e.forEach(t=>{ut=ut.concat(t)})):ut=[]}}catch(t){ut=[]}ut.length>0?(ft=[],x(ut),ht=[],c(ut)):d(),h()}d3.select(".filterClass3").remove();var n=P.append("g").attr("class","filterClass3").attr("id","filtersvg3");G=d3.max(t,function(t){return t.size}),1==yt&&(lt=G),yt=!1,U=d3.scaleLinear().domain([0,lt+lt/5]).range([0,ot.w]);var r=d3.axisBottom(U).ticks(5);K=d3.histogram().domain(U.domain()).thresholds(U.ticks(25)).value(function(t){return t.size}),pt=K(t).filter(t=>t.length>0),n.append("g").attr("class","axis xAxis").attr("transform","translate("+ot.x+","+ot.y+")").call(r).style("font-size",.6*R+"px").selectAll("text"),n.append("text").attr("text-anchor","end").attr("transform","translate("+(ot.w+1.12*ot.x)+","+(ot.y+2*b.top)+")rotate(0)").text($.i18n.prop("axis-x2")).style("font-size",.9*R+"px"),q=d3.max(pt,function(t){return t.length}),V=d3.scaleLinear().domain([q,0]).range([0,ct.h]);var s,i=d3.axisLeft(V).ticks(3);n.append("g").attr("class","axis xAxis").attr("transform","translate("+ct.x+","+ct.y+")").call(i).style("font-size",.6*R+"px"),n.append("text").attr("transform","translate("+(ct.x-20)+","+(ct.y-15)+")rotate(0)").text($.i18n.prop("axis-txs")).style("font-size",.9*R+"px");n.append("g").data(pt).attr("class","brush").call(d3.brushX().on("end",a));n.append("g").attr("fill","#d6b58e").selectAll("rect").data(pt).join("rect").attr("x",t=>U(t.x0)+ct.x+1).attr("width",t=>M).attr("y",t=>V(t.length)+ct.y).attr("height",t=>V(0)-V(t.length)).attr("fill-opacity",.9).text(t=>t.length).attr("value",t=>t.length).on("mouseover",e).on("mouseout",function(){$("#rectbar3").remove()})}function h(){var t=f();$("#coin_glyph").mask(),$("#txlistTable").mask(),r(t),s(t),$("#coin_glyph").unmask(),$("#txlistTable").unmask()}function f(){var t=ht.length,e=ft.length,a=ut.length;return t>0?ht:e>0?ft:a>0?ut:B.txs}var u,g=UrlParam.param("hash");if(void 0===g||64!=g.length){var m=GetUrlRelativePath();if(checkHash(m)){var y=m.split("/");g=y[2]}else{var v=$.i18n.prop("BlockHashinvalid");top.location.href="/info.html?message="+encodeURIComponent(v)}}u=0==datasource?{url:"/jsondata/blockhash.json",newblock:"/jsondata/indexnew.json"}:{url:weburl+"/silkchain/block/"+g,newblock:weburl+"/silkchain/indexnew"},testArray.blockhash.indexOf(g)>=0&&(u.url="/jsontest/blockhash/"+g+".json"),centw=window.innerWidth;var b={top:.01*centw,right:.01*centw,bottom:.01*centw,left:.01*centw},k=$("#coin_glyph").width(),_=.2*k<100?100:.2*k,w=(k-b.left-b.right)/7.5,z=1.2974*w;left_svg_w=.38*w*2,left_svg_h=.24*z*.88*2;var M,R=.01*k,A=($("#coin_radio").height(),left_svg_h),T=k-left_svg_w-.6*b.left,L=d3.select("#coin_glyph").append("svg").attr("width",.8*left_svg_w).attr("height",left_svg_h).attr("transform","translate("+.6*b.left+",10)").attr("class","mainsvg_block"),C=d3.select("#coin_glyph").append("svg").attr("width",T).attr("height",left_svg_h).attr("transform","translate(10,10)"),j=d3.select("#coin_filter").append("svg").attr("width",.32*k).attr("height",.5*_).attr("transform","translate(0,"+b.left+")"),I=d3.select("#coin_filter").append("svg").attr("width",.32*k).attr("height",.5*_).attr("transform","translate("+.37*k+","+b.left+")"),P=d3.select("#coin_filter").append("svg").attr("width",.32*k).attr("height",.5*_).attr("transform","translate("+.296*-k+","+b.left+")");t(u.newblock),e(u.url);var B,S,E,U,D,X,V,H,G,O,W,q,F,J,K,N,Q,Y,Z,tt,et,at,nt,rt,st,it,lt,ot={},ct={},dt=[],xt=[],pt=[],ht=[],ft=[],ut=[],gt=!0,mt=!0,yt=!0;$("#showhideBtn").bind("click",function(){var t=$("#showhideBtn").text();"显示"==t||"Show"==t?($("#showhideBtn").text($.i18n.prop("btn-hide")),$("#showhideDiv").show()):($("#showhideBtn").text($.i18n.prop("btn-show")),$("#showhideDiv").hide())})});