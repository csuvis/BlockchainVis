$(function(){function t(t){$.ajax({type:"get",async:!0,url:t,success:function(t){$("#s_lastestheight").html(t.height),$("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show()},error:function(t){console.log(t.statusText)}})}function e(t){$("#addrdetailTable").mask(),$.ajax({type:"get",async:!0,url:t,success:function(t){S=t.balance,$(".static_chart").mask(),$.ajax({type:"get",async:!0,url:x.url,success:function(t){n(t.items),$(".static_chart").unmask(),$("#listTableDiv2").hide()},error:function(t){console.error(t)}}),a(t),$("#addrdetailTable").unmask(),$("#listTableDiv").hide(),$(".moreshow").addClass("tt");var e=!0;$("#optionsRadios1").on("click",function(){e?($(".moreshow").removeClass("tt"),e=!1):($(".moreshow").addClass("tt"),e=!0)})},error:function(t){console.error(t)}}),$("#tokenlist").mask(),$.ajax({type:"get",async:!0,url:d.url,success:function(t){},error:function(t){console.error(t)}}),$("#addrtokentxslistTable").mask(),$.ajax({type:"get",async:!0,url:p.url,success:function(t){},error:function(t){console.error(t)}}),$("#addrtxslistTable").mask(),$.ajax({type:"get",async:!0,url:u.url,success:function(t){r(t),$("#addrtxslistTable").unmask(),$("#listTableDiv3").hide()},error:function(t){console.error(t)}})}function a(t){$("#addrStr").text(t.addrStr),$("#balance").text(t.balance+" SLU"),t.unconfirmedBalance>0?$("#unconfirmedBalance").text(t.unconfirmedBalance+" SLU"):$("#trunconfirmed").hide(),$("#totalReceived").text(t.totalReceived+" SLU"),$("#totalSent").text(t.totalSent+" SLU"),$("#txApperances").text(t.txApperances)}function r(t){$("#addrtxslistTable").bootstrapTable("destroy"),$("#addrtxslistTable").bootstrapTable({data:t.txs,pagination:!1,columns:[{title:$.i18n.prop("bt-txid"),field:"txid",align:"center",formatter:function(t,e,a){var r="<a href='/transaction/txid.html?txid="+t+"'>"+t+"</a>";return r}},{title:$.i18n.prop("bt-confirmations"),field:"confirmations",align:"center",sortable:!0},{title:$.i18n.prop("bt-vin_count"),field:"vin",align:"center",sortable:!0,formatter:function(t,e,a){return t.length}},{title:$.i18n.prop("bt-vout_count"),field:"vout",align:"center",sortable:!0,formatter:function(t,e,a){return t.length}},{title:$.i18n.prop("bt-time"),field:"time",align:"center",sortable:!0,formatter:function(t,e,a){return cnen_timeformater(t)}}]})}function n(t){function e(t,e){var a=Date.parse(t.key),r=Date.parse(e.key);return a-r}function a(){var t=d3.mouse(this)[0],e=d3.mouse(this)[1],a=Math.round((t-h.xx-g)/v.step());a=Math.max(0,a),a=Math.min(K.length-1,a);var r=K[a],n=z[a],s=Date.parse(r.key);s/=1e3,H.text($.i18n.prop("axis-date")+": "+cnen_timeformaterShort(s)).style("font-size",L+"px"),J.text($.i18n.prop("ad-FinalBalance")+": "+r.value.toFixed(3)+" SLU").style("font-size",L+"px"),N.text($.i18n.prop("svgTrans")+": "+n.value).style("font-size",L+"px"),t>.8*R&&e>.6*A?d3.select(".tips").attr("transform","translate("+(t-.23*R)+","+(e-.2*A)+")").style("display","block"):t>.8*R?d3.select(".tips").attr("transform","translate("+(t-.23*R)+","+e+")").style("display","block"):e>.6*A?d3.select(".tips").attr("transform","translate("+(t+.01*R)+","+(e-.2*A)+")").style("display","block"):d3.select(".tips").attr("transform","translate("+(t+.01*R)+","+(e+.01*A)+")").style("display","block")}if(t&&0!=t.length){var r=d3.timeFormat("%b %d"),n=d3.timeFormat("%m/%d/%Y");t=t.sort(function(t,e){return e.time0-t.time0});var s=d3.map(),l=(d3.map(),d3.map()),c=0,d=t.length,p=S;for(i=D;i>=B;i-=86400){var u=1e3*i,x=n(u);if(0==d)l.set(x,0),s.set(x,p);else{var f=1e3*t[c].time0,y=n(f);x!=y?(l.set(x,0),s.set(x,p)):(l.set(x,t[c].trans),s.set(x,t[c].balance),p=t[c].balance-t[c].balance_diff,c<d-1&&(c+=1))}}var h={xw:.935*R,xx:.04*R,xy:.75*A,yh:.6*A,yy:.15*A,y1x:.04*R,y2x:.975*R},m=F.append("g");m.append("rect").attr("x",h.xx+.32*R).attr("y",.045*A).attr("class","line3-text").attr("width",.02*R).attr("height",.001*R),m.append("circle").attr("cx",h.xx+.33*R).attr("cy",.045*A+5e-4*R).attr("r",.002*R).attr("class","line3-text"),m.append("text").attr("x",h.xx+.35*R).attr("y",.055*A).attr("class","legend").text($.i18n.prop("ad-FinalBalance")).style("font-family","sans-serif").style("font-size",.75*L+"px"),m.append("text").attr("x",h.xx+.52*R).attr("y",.055*A).attr("class","bar1-rect").text("■").style("font-size",.75*L+"px"),m.append("text").attr("x",h.xx+.535*R).attr("y",.055*A).attr("class","legend").text($.i18n.prop("svgTrans")).style("font-family","sans-serif").style("font-size",.75*L+"px");var b=l.keys().reverse(),v=d3.scaleBand().domain(b).range([0,h.xw]),g=v.bandwidth()/2;g=Math.min(10,g);var w=d3.axisBottom(v).tickFormat(function(t,e){var a=Date.parse(t);return r(a)});F.append("g").attr("class","axis tjbx").attr("transform","translate("+h.xx+","+h.xy+")").call(w).selectAll("text").attr("transform","rotate(-30)").style("text-anchor","end").style("font-size",.65*L+"px");var k=F.append("g").on("mousemove",a).on("mouseout",function(){d3.select(".tips").style("display","none")}),j=d3.max(l.values());0==j&&(j=1);var T=d3.scaleLinear().range([0,h.yh]).domain([1.2*j,0]),_=d3.axisRight(T).ticks(5).tickFormat(function(t){return o(t,4)});F.append("g").attr("class","axis tjby2").attr("transform","translate("+h.y2x+","+h.yy+")").call(_).selectAll("text").style("font-size",.65*L+"px"),F.append("text").attr("transform","translate("+(h.y2x+.025*R)+","+(h.yy-.03*A)+")").text($.i18n.prop("svgTrans")).style("font-family","sans-serif").style("font-size",.75*L+"px").attr("text-anchor","end");var z=l.entries();z=z.sort(e);k.selectAll(".barRect").data(z).enter().append("g").attr("class","barRect").append("rect").attr("class","bar1-rect").attr("width",g).attr("y",function(t){return h.yy+T(t.value)}).attr("x",function(t){return h.xx+v(t.key)+.5*v.bandwidth()-.5*g}).attr("height",function(t){return h.yh-T(t.value)});var U=d3.max(s.values()),M=d3.min(s.values()),C=M-.1*(U-M);C<0&&(C=0);var P=U+.1*(U-M),E=d3.scaleLinear().range([0,h.yh]).domain([P,C]),V=[];V.push(C);var Y=(P-C)/5;V.push(C+Y),V.push(C+2*Y),V.push(C+3*Y),V.push(C+4*Y),V.push(C+5*Y);var G=d3.axisLeft(E).tickValues(V).tickFormat(function(t){return o(t,4)});F.append("g").attr("class","axis tjby1").attr("transform","translate("+h.y1x+","+h.yy+")").call(G).selectAll("text").style("font-size",.65*L+"px"),F.append("text").attr("transform","translate("+(h.y1x-.035*R)+","+(h.yy-.03*A)+")").text($.i18n.prop("ad-FinalBalance")).style("font-family","sans-serif").style("font-size",.75*L+"px").attr("text-anchor","start");var I=d3.line().x(function(t){return h.y1x+v(t.key)+.5*v.bandwidth()}).y(function(t){return h.yy+E(t.value)}),K=s.entries();K=K.sort(e);k.append("g").append("path").attr("d",I(K)).attr("class","line3-rect").style("stroke-width",.001*R),k.selectAll("circle .tjby3-line").data(K).enter().append("circle").attr("class","tjby3-line").attr("cx",function(t){return h.y1x+v(t.key)+.5*v.bandwidth()}).attr("cy",function(t){return h.yy+E(t.value)}).attr("r",function(t){return.002*R}).attr("class","line3-text");var q=F.append("g").attr("class","tips").style("display","none");q.append("rect").attr("class","tips-border").attr("width",.22*R).attr("height",.14*A).attr("rx",10).attr("ry",10);var H=q.append("text").attr("class","tips-text blocktextblack").attr("x",L).attr("y",.04*A).text("").style("font-size",L+"px"),J=q.append("text").attr("class","tips-text blocktextblack").attr("x",L).attr("y",.08*A).text("").style("font-size",L+"px"),N=q.append("text").attr("class","tips-text blocktextblack").attr("x",L).attr("y",.12*A).text("").style("font-size",L+"px")}}function s(t){var e=new RegExp("^/address/(\\w{36})$");return!!e.test(t)}function l(t,e){var a=Math.pow(10,e),r=Math.round(t*a)/a,n=r.toString();return n}function o(t,e){return t>=1e6?l(t/1e6,e)+"M":t>=1e3?l(t/1e3,e)+"K":l(t,e)}var c,d,p,u,x,f,y=UrlParam.param("addr"),h=UrlParam.param("fromdate");if(void 0===h)h="";else try{var m=/^[2][0][0-9]{2}-[0-1]{1}[0-9]{1}-[0-3]{1}[0-9]{1}$/,b=new RegExp(m);b.test(h)||(h="")}catch(t){h=""}if(void 0===y||36!=y.length){var v=GetUrlRelativePath();if(s(v)){var g=v.split("/");y=g[2]}else{var w=$.i18n.prop("Addressinvalid");top.location.href="/info.html?message="+encodeURIComponent(w)}}c=0==datasource?{url:"/jsondata/addr.json",newblock:"/jsondata/indexnew.json"}:{url:weburl+"/addr/"+y+"?noTxList=1",newblock:weburl+"/silkchain/indexnew"},d=0==datasource?{url:"/jsondata/addrtoken.json"}:{url:weburl+"/src20/balances?balanceAddress="+y},p=0==datasource?{url:"/jsondata/addrtokenTxs.json"}:{url:weburl+"/tokenTransfer?address="+y+"&limit=50"},u=0==datasource?{url:"/jsondata/addrVoutxrange.json"}:"2019-06-12"==h?{url:"/jsondata/txsaddr20190612.json"}:{url:weburl+"/txs/?address="+y},f=h.length>0?new Date(h):new Date;var k=f.format("m/d/Y"),j=k+" 00:00:01",T=new Date(j),_=k+" 23:59:59",z=new Date(_),D=T.getTime()/1e3,B=(z.getTime(),D-2592e3),S=0;x=0==datasource?{url:"/jsondata/addrtimesvalue2.json"}:"2019-06-12"==h?{url:"/jsondata/historynew20190612.json"}:h.length>0?{url:weburl+"/silkchain/addr/"+y+"/historynew?from_date_time="+D}:{url:weburl+"/silkchain/addr/"+y+"/historynew"};var R=$(".static_chart").width(),A=Math.max(.3*R,150),F=d3.select(".static_chart").append("svg").attr("width",R).attr("height",.85*A),L=.01*R;t(c.newblock),e(c.url);L=.0102*R;$("#showhideBtn").bind("click",function(){var t=$("#showhideBtn").text();"显示"==t||"Show"==t?($("#showhideBtn").text($.i18n.prop("btn-hide")),$("#showhideDiv").show()):($("#showhideBtn").text($.i18n.prop("btn-show")),$("#showhideDiv").hide())})});