$(function(){function t(){$("#d3layout").mask(),$.ajax({type:"get",async:!0,url:f.ajaxBlockcount,data:{height:m},success:function(t){t.result&&($("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show(),m=c>0?c:t.height,$("#s_lastestheight").html(m),x=t.transactions,a(),$("#d3layout").unmask())},error:function(t){console.log(t.statusText)}})}function a(){$("#loading").removeClass("hidden"),$.ajax({type:"get",async:!0,url:f.ajaxsvgdata,success:function(t){for(let a=0;a<t.items.length;a++)t.items[a].transaction_count=t.items[a].transaction_count-1;e(t,m,x),$("#loading").addClass("hidden")},error:function(t){console.error(t.statusText)}})}function e(t,a,e){d3.select(".mainClass").remove(),M=A.append("g").attr("class","mainClass");var l=t.items[0].time_diff_lastblock,o=t.items[0].time_diff_lastblock;for(let a=1;a<t.items.length-1;a++)l<t.items[a].time_diff_lastblock&&(l=t.items[a].time_diff_lastblock),o>t.items[a].time_diff_lastblock&&(o=t.items[a].time_diff_lastblock);var c=d3.scaleLinear().domain([o,l]).range([j,w]),p=0;for(let a=0;a<t.items.length-1;a++)p+=c(t.items[a].time_diff_lastblock);var d=u-b.left-b.right-6*k,h=d/p;g=function(t){return h*c(t)};var x=M.append("g").attr("class","block6").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[5].hash}));s(x,H);r(x,6,H,t);var f={x:b.left+k+g(t.items[4].time_diff_lastblock),y:b.top,width:k,height:_,no:5,opacity:.8},m=M.append("g").attr("class","block5").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[4].hash}));s(m,f);r(m,5,f,t);var y={x:b.left+2*k+g(t.items[4].time_diff_lastblock)+g(t.items[3].time_diff_lastblock),y:b.top,width:k,height:_,no:4,opacity:.68},v=M.append("g").attr("class","block4").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[3].hash}));s(v,y);r(v,4,y,t);var z={x:b.left+3*k+g(t.items[4].time_diff_lastblock)+g(t.items[3].time_diff_lastblock)+g(t.items[2].time_diff_lastblock),y:b.top,width:k,height:_,no:3,opacity:.55},T=M.append("g").attr("class","block3").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[2].hash}));s(T,z);r(T,3,z,t);var L={x:b.left+4*k+g(t.items[4].time_diff_lastblock)+g(t.items[3].time_diff_lastblock)+g(t.items[2].time_diff_lastblock)+g(t.items[1].time_diff_lastblock),y:b.top,width:k,height:_,no:2,opacity:.4},B=M.append("g").attr("class","block2").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[1].hash}));s(B,L);r(B,2,L,t);var C=M.append("g").attr("fill","none").attr("stroke","#a07757").attr("stroke-width",F);n(C,H,4,t),n(C,f,3,t),n(C,y,2,t),n(C,z,1,t);var S={x:b.left+5*k+g(t.items[4].time_diff_lastblock)+g(t.items[3].time_diff_lastblock)+g(t.items[2].time_diff_lastblock)+g(t.items[1].time_diff_lastblock)+g(t.items[0].time_diff_lastblock),y:b.top,width:k,height:_,no:1,opacity:.3},R=M.append("g").attr("class","block1").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[0].hash})),P=R.append("g").attr("fill","none").attr("stroke","#91633F").attr("stroke-width",F);n(P,L,0,t);s(R,S);var U=r(R,1,S,t),I={x0:S.x,y0:S.y,x1:0,y1:0};U.attr("transform","translate("+I.x0+","+I.y0+")").transition().duration(2e3).ease(d3.easeElasticInOut).attr("transform","translate("+I.x1+","+I.y1+")");var D={x:H.x+k,y:H.y+.45*_,w:g(t.items[4].time_diff_lastblock),h:_/5},E=M.append("g").attr("class","chain65");i(E,D,t.items[4].previousblockhash,t.items[4].time_diff_lastblock);var N={x:f.x+k,y:f.y+.45*_,w:g(t.items[3].time_diff_lastblock),h:_/6},K=M.append("g").attr("class","chain54");i(K,N,t.items[3].previousblockhash,t.items[3].time_diff_lastblock);var O={x:y.x+k,y:y.y+.45*_,w:g(t.items[2].time_diff_lastblock),h:_/5},q=M.append("g").attr("class","chain43");i(q,O,t.items[2].previousblockhash,t.items[2].time_diff_lastblock);var G={x:z.x+k,y:z.y+.45*_,w:g(t.items[1].time_diff_lastblock),h:_/5},J=M.append("g").attr("class","chain32");i(J,G,t.items[1].previousblockhash,t.items[1].time_diff_lastblock);var Q={x:L.x+k,y:L.y+.45*_,w:g(t.items[0].time_diff_lastblock),h:_/5},V=M.append("g").attr("class","chain21"),W=i(V,Q,t.items[0].previousblockhash,t.items[0].time_diff_lastblock),X={x0:Q.x,y0:Q.y,x1:0,y1:0};W.attr("transform","translate("+X.x0+","+X.y0+")").transition().duration(2e3).ease(d3.easeElasticInOut).attr("transform","translate("+X.x1+","+X.y1+")")}function s(t,a){return t.append("image").attr("opacity",a.opacity).attr("xlink:href","/images/bg2.png").attr("x",a.x).attr("y",a.y).attr("width",a.width).attr("height",a.height)}function r(t,a,e,s){t.append("g").append("rect").attr("class","barbgclass").attr("x",e.x+.1*k).attr("y",e.y+.08*_).attr("width",L).attr("height",.88*B).attr("fill-opacity",.2),appendLineText(t,$.i18n.prop("svgHeight"),e.x+.115*k,e.y+.07*_,L,.2*_),appendLineText(t,s.items[a-1].height,e.x+.15*k,e.y+.25*_,L,.3*B),t.append("g").append("rect").attr("class","barbgclass").attr("x",e.x+.52*k).attr("y",e.y+.08*_).attr("width",L).attr("height",.88*B).attr("fill-opacity",.2),appendLineText(t,$.i18n.prop("bi-Confirmations"),e.x+.535*k,e.y+.07*_,L,.2*_);var r=m-s.items[a-1].height+1+"",i=(appendLineText(t,r,e.x+.69*k,e.y+.25*_,L,.3*B),s.items[a-1].hash),n=appendLineText(t,$.i18n.prop("svgBlockHash")+": "+i.substring(0,5)+"..."+i.substring(i.length-5,i.length),e.x+.126*k,e.y+.4*_,.88*k,.051*_);n.append("title").text($.i18n.prop("svgBlockHash")+": "+i);var l=s.items[a-1].previousblockhash,o=appendLineText(t,$.i18n.prop("svgPreviousBlockHash")+": "+l.substring(0,3)+"..."+l.substring(l.length-3,l.length),e.x+.126*k,e.y+.47*_,.88*k,.051*_);o.append("title").text($.i18n.prop("svgPreviousBlockHash")+": "+l);var c=s.items[a-1].merkleroot,p=appendLineText(t,$.i18n.prop("svgMerkleRoot")+": "+c.substring(0,4)+"..."+c.substring(c.length-5,c.length),e.x+.126*k,e.y+.54*_,.88*k,.051*_);p.append("title").text($.i18n.prop("svgMerkleRoot")+": "+c);var d=cnen_timeformater(s.items[a-1].time),h=appendLineText(t,$.i18n.prop("svgAge")+": "+d,e.x+.126*k,e.y+.61*_,.88*k,.051*_);h.append("title").text($.i18n.prop("svgAge")+": "+d);var x=t.append("g"),f=(x.append("rect").attr("class","barbgclass").attr("x",e.x+.1*k).attr("y",e.y+.77*_).attr("width",z).attr("height",T).attr("fill-opacity",.2),s.items[a-1].size);f=f.toFixed(0);var y=s.items[a-1].size/8e6,g=(x.append("rect").attr("class","barfgclass").attr("x",e.x+.1*k).attr("y",e.y+.77*_).attr("width",y*z).attr("height",T).attr("fill-opacity",e.opacity),appendLineText(x,$.i18n.prop("svgSize")+": "+f+" Bytes",e.x+.12*k,e.y+.77*_+.7*T,z,.6*T));g.attr("class","blocktextblack"),x.append("title").text($.i18n.prop("svgSize")+": "+f+" Bytes");var u=t.append("g");u.append("rect").attr("class","barbgclass").attr("x",e.x+.1*k).attr("y",e.y+.69*_).attr("width",z).attr("height",T).attr("fill-opacity",.2);var b=s.items[a-1].transaction_count/s.max_transaction_count;u.append("rect").attr("class","barfgclass").attr("x",e.x+.1*k).attr("y",e.y+.69*_).attr("width",b*z).attr("height",T).attr("fill-opacity",e.opacity);var v=appendLineText(u,$.i18n.prop("svgTrans")+": "+s.items[a-1].transaction_count,e.x+.12*k,e.y+.69*_+.7*T,z,.6*T);v.attr("class","blocktextblack"),u.append("title").text($.i18n.prop("svgTrans")+": "+s.items[a-1].transaction_count);var w=t.append("g");w.append("rect").attr("class","barbgclass").attr("x",e.x+.1*k).attr("y",e.y+.85*_).attr("width",z).attr("height",T).attr("fill-opacity",.2);var j=s.items[a-1].txfee_sum+s.items[a-1].reward,F=j/(s.max_txfee_sum+s.items[a-1].reward);w.append("rect").attr("class","barfgclass").attr("x",e.x+.1*k).attr("y",e.y+.85*_).attr("width",F*z).attr("height",T).attr("fill-opacity",e.opacity);var C=appendLineText(w,$.i18n.prop("svgFee")+": "+j.toFixed(3)+" SLU",e.x+.12*k,e.y+.85*_+.7*T,z+.14*k,.6*T);return C.attr("class","blocktextblack"),w.append("title").text($.i18n.prop("svgFee")+": "+j.toFixed(3)+" SLU"),t}function i(t,a,e,s){appendChainText(t,s+$.i18n.prop("svgSecond"),a.x+.01*k,a.y-.01*_,.8*a.w,.8*a.h).append("title").text($.i18n.prop("svgTimeDiff")+"："+s+$.i18n.prop("svgSecond")+"; "+$.i18n.prop("svgPreviousBlockHash")+":"+e);return t}function n(t,a,e,s){return t.append("image").attr("xlink:href","/images/left.png").attr("x",a.x+k).attr("y",a.y+.52*_-.02896*_).attr("width",.05*k).attr("height",.05792*_),t.append("path").attr("stroke-dasharray",C).attr("d",function(){var t=a.x+k+.03*k,r=a.y+.52*_,i=g(s.items[e].time_diff_lastblock)-.02*k,n="M"+t+" "+r+" l"+i+" 0";return n}),t}function l(){$("#d3tjb").mask(),$.ajax({type:"get",async:!0,url:f.ajaxtjs30,success:function(t){o(t),$("#d3tjb").unmask()},error:function(t){console.error(t.statusText)}})}function o(t){function a(){var a=d3.mouse(this)[0],e=d3.mouse(this)[1],s=Math.round((a-p.x-f)/o.step()),r=t.length-s-1;r=Math.max(0,r),r=Math.min(t.length-1,r);var i=t[r];z.text($.i18n.prop("axis-date")+": "+cnen_timeformaterShort(i.dateTime)).style("font-size",S+"px"),T.text($.i18n.prop("g-reward")+": "+i.reward_sum+" SLU").style("font-size",S+"px"),L.text($.i18n.prop("g-block")+": "+i.reward_sum).style("font-size",S+"px"),B.text($.i18n.prop("g-transaction_count")+": "+i.transaction_count).style("font-size",S+"px"),a>.8*u&&e>.85*v?d3.select(".tips").attr("transform","translate("+(a-.18*u)+","+(e-.2*v)+")").style("display","block"):a>.8*u?d3.select(".tips").attr("transform","translate("+(a-.18*u)+","+e+")").style("display","block"):e>.85*v?d3.select(".tips").attr("transform","translate("+(a+.01*u)+","+(e-.2*v)+")").style("display","block"):d3.select(".tips").attr("transform","translate("+(a+.01*u)+","+(e+.01*v)+")").style("display","block")}d3.select(".tjbClass").remove(),U=P.append("g").attr("class","tjbClass");var e=U.append("g");e.append("rect").attr("x",I.left+3.9*k).attr("y",.035*_).attr("class","line3-text").attr("width",.2*k).attr("height",.01*k),e.append("circle").attr("cx",I.left+4*k).attr("cy",.038*_).attr("r",.018*k).attr("class","line3-text"),e.append("text").attr("x",I.left+4.2*k).attr("y",.05*_).attr("class","legend").text($.i18n.prop("g-transaction_count")).style("font-family","sans-serif").style("font-size",.75*S+"px"),e.append("text").attr("x",I.left+2.7*k).attr("y",.05*_).attr("class","bar1-rect").text("■").style("font-size",.75*S+"px"),e.append("text").attr("x",I.left+2.8*k).attr("y",.05*_).attr("class","legend").text($.i18n.prop("g-reward_sum")).style("font-family","sans-serif").style("font-size",.75*S+"px");var s=d3.timeFormat("%b %d"),r=[],i=[],n=[],l=[];for(let a=t.length-1;a>=0;a--)r.push(t[a].date),i.push(t[a].reward_sum+t[a].txfee_sum),n.push(t[a].block_count),l.push(t[a].transaction_count);var o=d3.scaleBand().domain(r).range([0,D.width]),c=d3.axisBottom(o).tickFormat(function(a,e){var r=20;if(t.length>r){var i=Math.floor(t.length/r);if(e%i==0){var n=new Date(a);return s(n)}return""}n=new Date(a);return s(n)});U.append("g").attr("class","axis tjbx").attr("transform","translate("+D.x+","+D.y+")").call(c).selectAll("text").attr("transform","rotate(-30)").style("text-anchor","end").style("font-size",.6*S+"px");var p={height:_,chartheight:.5*(R-.4*_),x:I.left+.14*k,y:.22*_},d=d3.scaleLinear().range([0,p.height]).domain([d3.max(i),0]),h=d3.axisLeft(d).ticks(5).tickFormat(function(t){return t>=1e3?(t/1e3).toFixed(1)+"K":t});U.append("g").attr("class","axis tjby1").attr("transform","translate("+p.x+","+p.y+")").call(h).selectAll("text").style("font-size",.65*S+"px"),U.append("text").attr("transform","translate("+(p.x-2*S)+","+.15*_+")").text($.i18n.prop("axis-values")).style("font-family","sans-serif").style("font-size",.75*S+"px");var x=U.append("g").on("mousemove",a).on("mouseout",function(){d3.select(".tips").style("display","none")}),f=o.bandwidth()/2,m=x.selectAll(".barRect").data(t).enter().append("g").attr("class","barRect");m.append("rect").attr("class","bar1-rect").attr("width",f).attr("y",function(t){return p.y+d(t.reward_sum)}).attr("x",function(t){return p.x+o(t.date)+.5*f}).attr("height",function(t){return p.height-d(t.reward_sum)});var y={height:p.height,x:u-.4*k,y:.22*_},g=d3.scaleLinear().range([0,y.height]).domain([d3.max(l),0]),b=d3.axisRight(g).ticks(5).tickFormat(function(t){return t>=1e3?(t/1e3).toFixed(1)+"K":t});U.append("g").attr("class","axis tjby3").attr("transform","translate("+y.x+","+y.y+")").call(b).selectAll("text").style("font-size",.65*S+"px"),U.append("text").attr("transform","translate("+(y.x-.15*k)+","+.15*_+")").text($.i18n.prop("axis-txs")).style("font-family","sans-serif").style("font-size",.75*S+"px");var w=d3.line().x(function(t){return p.x+o(t.date)+1*f}).y(function(t){return p.y+g(t.transaction_count)}),j=(x.append("g").append("path").attr("d",w(t)).attr("class","line3-rect").style("stroke-width",.01*k),x.selectAll("circle .tjby3-line").data(t).enter().append("circle").attr("class","tjby3-line").attr("cx",function(t){return p.x+o(t.date)+1*f}).attr("cy",function(t){return p.y+g(t.transaction_count)}).attr("r",.018*k).attr("class","line3-text"),x.append("g").attr("class","tips").style("display","none"));j.append("rect").attr("class","tips-border").attr("width",1.16*k).attr("height",.325*_).attr("rx",10).attr("ry",10);var z=j.append("text").attr("class","tips-text blocktextblack").attr("x",S).attr("y",.06*_).text("").style("font-size",S+"px"),T=j.append("text").attr("class","tips-text blocktextblack").attr("x",S).attr("y",.13*_).text("").style("font-size",S+"px"),L=j.append("text").attr("class","tips-text blocktextblack").attr("x",S).attr("y",.21*_).text("").style("font-size",S+"px"),B=j.append("text").attr("class","tips-text blocktextblack").attr("x",S).attr("y",.29*_).text("").style("font-size",S+"px")}var c=UrlParam.param("fromheight"),p=UrlParam.param("fromdate");if(void 0===c)c=0;else try{c=parseInt(c),isNaN(c)&&(c=0)}catch(t){c=0}if(void 0===p)p="";else try{var d=/^[2][0][0-9]{2}-[0-1]{1}[0-9]{1}-[0-3]{1}[0-9]{1}$/,h=new RegExp(d);h.test(p)||(p="")}catch(t){p=""}var x,f,m=c;if(0==datasource?f={ajaxBlockcount:"/jsondata/indexnew.json",ajaxsvgdata:"/jsondata/indexlimit6.json",ajaxtjs30:"/jsondata/transactionNums.json"}:(f={ajaxBlockcount:weburl+"/silkchain/indexnew",ajaxsvgdata:weburl+"/silkchain/index?limit=6&fromheight="+m,ajaxtjs30:weburl+"/silkchain/statistics/transactions?days=90"},"211199"==c&&(f.ajaxsvgdata="/jsondata/indexlimit6.json"),p.length>0&&(f.ajaxtjs30="2019-06-12"==p?"/jsondata/txsday20190612.json":weburl+"/silkchain/statistics/transactions?days=90&fromdate="+p)),t(),l(),c>0);else{var y=io(webhost);y.on("connect",function(){y.emit("subscribe","silubiumd/hashblock")}),y.on("silubiumd/hashblock",function(a){setTimeout(t,5e3)})}setInterval(l,6e5);var g,u=$("#d3layout").width(),b={top:0,right:.02*u,bottom:.01*u,left:.005*u},k=(u-b.left-b.right)/7.5,_=1.2974*k,v=_,w=.6*k,j=.3*k,z=.8*k,T=.07*_,L=.38*k,B=.24*_,F=.012*k,C=F+","+F,S=.0102*u,A=d3.select("#d3layout").append("svg").attr("width",u).attr("height",v).attr("transform","translate(0,"+.03*_+")"),M=A.append("g").attr("class","mainClass"),H={x:b.left,y:b.top,width:k,height:_,no:6,opacity:1},R=v,P=d3.select("#d3tjb").append("svg").attr("width",u).attr("height",1.4*_).attr("transform","translate("+b.left+",0)"),U=P.append("g").attr("class","tjbClass"),I={left:b.left,top:b.top+v},D={width:u-.576*k,x:I.left+.14*k,y:1.22*_};D.x,D.y,D.width});