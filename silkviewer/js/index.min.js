$(function(){function t(){$("#d3layout").mask(),$.ajax({type:"get",async:!0,url:b.ajaxBlockcount,data:{height:_},success:function(t){t.result&&($("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show(),_=p>0?p:t.height,$("#s_lastestheight").html(_),k=t.transactions,a(),$("#d3layout").unmask())},error:function(t){console.log(t.statusText)}})}function a(){$("#loading").removeClass("hidden"),$.ajax({type:"get",async:!0,url:b.ajaxsvgdata,success:function(t){for(let a=0;a<t.items.length;a++)t.items[a].transaction_count=t.items[a].transaction_count-1;e(t,_,k),$("#loading").addClass("hidden")},error:function(t){console.error(t.statusText)}})}function e(t,a,e){d3.select(".mainClass").remove(),E=S.append("g").attr("class","mainClass");var p=t.items[0].time_diff_lastblock,m=t.items[0].time_diff_lastblock;for(let a=1;a<t.items.length-1;a++)p<t.items[a].time_diff_lastblock&&(p=t.items[a].time_diff_lastblock),m>t.items[a].time_diff_lastblock&&(m=t.items[a].time_diff_lastblock);var d=d3.scaleLinear().domain([m,p]).range([L,T]),f=0,k=0;for(let a=0;a<4;a++)f+=d(t.items[a].time_diff_lastblock);for(let a=5;a<9;a++)k+=d(t.items[a].time_diff_lastblock);var b=Math.max(f,k),_=y-u.left-u.right-5*v,x=_/b;g=function(t){return x*d(t)};var j={x:u.left,y:u.top,width:v,height:w,no:5,opacity:.8},B=E.append("g").attr("class","block5").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[4].hash}));i(B,j);l(B,5,j,t);var C={x:u.left+v+g(t.items[3].time_diff_lastblock),y:u.top,width:v,height:w,no:4,opacity:.68},H=E.append("g").attr("class","block4").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[3].hash}));i(H,C);l(H,4,C,t);var M={x:u.left+2*v+g(t.items[3].time_diff_lastblock)+g(t.items[2].time_diff_lastblock),y:u.top,width:v,height:w,no:3,opacity:.55},z=E.append("g").attr("class","block3").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[2].hash}));i(z,M);l(z,3,M,t);var I={x:u.left+3*v+g(t.items[3].time_diff_lastblock)+g(t.items[2].time_diff_lastblock)+g(t.items[1].time_diff_lastblock),y:u.top,width:v,height:w,no:2,opacity:.4},N=E.append("g").attr("class","block2").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[1].hash}));i(N,I);l(N,2,I,t);var R=E.append("g").attr("fill","none").attr("stroke","#a07757").attr("stroke-width",P);n(R,j,3,t),n(R,C,2,t),n(R,M,1,t);var A={x:u.left+4*v+g(t.items[3].time_diff_lastblock)+g(t.items[2].time_diff_lastblock)+g(t.items[1].time_diff_lastblock)+g(t.items[0].time_diff_lastblock),y:u.top,width:v,height:w,no:1,opacity:.3},F=E.append("g").attr("class","block1").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[0].hash})),O=F.append("g").attr("fill","none").attr("stroke","#91633F").attr("stroke-width",P);n(O,I,0,t);i(F,A);var U=l(F,1,A,t),D={x0:A.x,y0:A.y,x1:0,y1:0};U.attr("transform","translate("+D.x0+","+D.y0+")").transition().duration(2e3).ease(d3.easeElasticInOut).attr("transform","translate("+D.x1+","+D.y1+")");var G={x:u.left,y:u.top+w+g(t.items[4].time_diff_lastblock),width:v,height:w,no:6,opacity:1},q=E.append("g").attr("class","block6").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[5].hash}));i(q,G);l(q,6,G,t),c(R,G,4,t);var J={x:u.left+v+g(t.items[5].time_diff_lastblock),y:u.top+w+g(t.items[4].time_diff_lastblock),width:v,height:w,no:7,opacity:1},K=E.append("g").attr("class","block7").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[6].hash}));i(K,J);l(K,7,J,t),h(R,J,5,t);var Q={x:u.left+2*v+g(t.items[5].time_diff_lastblock)+g(t.items[6].time_diff_lastblock),y:u.top+w+g(t.items[4].time_diff_lastblock),width:v,height:w,no:8,opacity:1},V=E.append("g").attr("class","block8").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[7].hash}));i(V,Q);l(V,8,Q,t),h(R,Q,6,t);var W={x:u.left+3*v+g(t.items[5].time_diff_lastblock)+g(t.items[6].time_diff_lastblock)+g(t.items[7].time_diff_lastblock),y:u.top+w+g(t.items[4].time_diff_lastblock),width:v,height:w,no:9,opacity:1},X=E.append("g").attr("class","block9").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[8].hash}));i(X,W);l(X,9,W,t),h(R,W,7,t);var Y={x:u.left+4*v+g(t.items[5].time_diff_lastblock)+g(t.items[6].time_diff_lastblock)+g(t.items[7].time_diff_lastblock)+g(t.items[8].time_diff_lastblock),y:u.top+w+g(t.items[4].time_diff_lastblock),width:v,height:w,no:10,opacity:1},Z=E.append("g").attr("class","block10").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[9].hash}));i(Z,Y);l(Z,10,Y,t),h(R,Y,8,t);var tt={x:Y.x,y:Y.y+w+g(t.items[9].time_diff_lastblock),width:v,height:w,no:11,opacity:1},at=E.append("g").attr("class","block11").append("a").attr("xlink:href","/block/blockhash.html?"+$.param({hash:t.items[10].hash}));i(at,tt);l(at,11,tt,t),c(R,tt,9,t);var et={x:u.left,y:Y.y+w+g(t.items[9].time_diff_lastblock),width:v,height:w,no:0,opacity:1},it=E.append("g").attr("class","block0");s(it,et);o(it,0,et,t);var st={x:tt.x+.502*v,y:tt.y-.42*g(t.items[9].time_diff_lastblock),w:.5*v,h:w/5},lt=E.append("g").attr("class","chain1110");r(lt,st,t.items[9].previousblockhash,t.items[9].time_diff_lastblock);var ot={x:Y.x-g(t.items[8].time_diff_lastblock),y:Y.y+.45*w,w:g(t.items[8].time_diff_lastblock),h:w/5},rt=E.append("g").attr("class","chain109");r(rt,ot,t.items[8].previousblockhash,t.items[8].time_diff_lastblock);var nt={x:W.x-g(t.items[7].time_diff_lastblock),y:W.y+.45*w,w:g(t.items[7].time_diff_lastblock),h:w/5},ct=E.append("g").attr("class","chain98");r(ct,nt,t.items[7].previousblockhash,t.items[7].time_diff_lastblock);var ht={x:Q.x-g(t.items[6].time_diff_lastblock),y:Q.y+.45*w,w:g(t.items[6].time_diff_lastblock),h:w/5},pt=E.append("g").attr("class","chain87");r(pt,ht,t.items[6].previousblockhash,t.items[6].time_diff_lastblock);var mt={x:J.x-g(t.items[5].time_diff_lastblock),y:J.y+.45*w,w:g(t.items[5].time_diff_lastblock),h:w/5},dt=E.append("g").attr("class","chain76");r(dt,mt,t.items[5].previousblockhash,t.items[5].time_diff_lastblock);var ft={x:G.x+.502*v,y:G.y-.42*g(t.items[4].time_diff_lastblock),w:.5*v,h:w/5},kt=E.append("g").attr("class","chain65");r(kt,ft,t.items[4].previousblockhash,t.items[4].time_diff_lastblock);var bt={x:j.x+v,y:j.y+.45*w,w:g(t.items[3].time_diff_lastblock),h:w/6},_t=E.append("g").attr("class","chain54");r(_t,bt,t.items[3].previousblockhash,t.items[3].time_diff_lastblock);var xt={x:C.x+v,y:C.y+.45*w,w:g(t.items[2].time_diff_lastblock),h:w/5},gt=E.append("g").attr("class","chain43");r(gt,xt,t.items[2].previousblockhash,t.items[2].time_diff_lastblock);var yt={x:M.x+v,y:M.y+.45*w,w:g(t.items[1].time_diff_lastblock),h:w/5},ut=E.append("g").attr("class","chain32");r(ut,yt,t.items[1].previousblockhash,t.items[1].time_diff_lastblock);var vt={x:I.x+v,y:I.y+.45*w,w:g(t.items[0].time_diff_lastblock),h:w/5},$t=E.append("g").attr("class","chain21"),wt=r($t,vt,t.items[0].previousblockhash,t.items[0].time_diff_lastblock),jt={x0:vt.x,y0:vt.y,x1:0,y1:0};wt.attr("transform","translate("+jt.x0+","+jt.y0+")").transition().duration(2e3).ease(d3.easeElasticInOut).attr("transform","translate("+jt.x1+","+jt.y1+")")}function i(t,a){return t.append("image").attr("opacity",a.opacity).attr("xlink:href","/images/block6.png").attr("x",a.x).attr("y",a.y).attr("width",a.width).attr("height",a.height)}function s(t,a){return t.append("image").attr("opacity",a.opacity).attr("xlink:href","/images/block0.png").attr("x",a.x).attr("y",a.y).attr("height",a.height)}function l(t,a,e,i){appendLineText(t,$.i18n.prop("svgHeight")+":"+i.items[a-1].height,e.x+.126*v,e.y+.45*w,.88*v,.051*w);var s=_-i.items[a-1].height+1+"",l=(appendLineText(t,s,e.x+.69*v,e.y+.14*w,H,.3*M),i.items[a-1].hash),o=appendLineText(t,$.i18n.prop("svgBlockHash")+": "+l.substring(0,5)+"..."+l.substring(l.length-5,l.length),e.x+.126*v,e.y+.51*w,.88*v,.051*w);o.append("title").text($.i18n.prop("svgBlockHash")+": "+l);var r=i.items[a-1].previousblockhash,n=appendLineText(t,$.i18n.prop("svgPreviousBlockHash")+": "+r.substring(0,3)+"..."+r.substring(r.length-3,r.length),e.x+.126*v,e.y+.58*w,.88*v,.051*w);n.append("title").text($.i18n.prop("svgPreviousBlockHash")+": "+r);var c=i.items[a-1].merkleroot,h=appendLineText(t,$.i18n.prop("svgMerkleRoot")+": "+c.substring(0,4)+"..."+c.substring(c.length-5,c.length),e.x+.126*v,e.y+.65*w,.88*v,.051*w);h.append("title").text($.i18n.prop("svgMerkleRoot")+": "+c);var p=cnen_timeformater(i.items[a-1].time),m=appendLineText(t,$.i18n.prop("svgAge")+": "+p,e.x+.126*v,e.y+.72*w,.88*v,.051*w);m.append("title").text($.i18n.prop("svgAge")+": "+p);var d=t.append("g"),f=(d.append("rect").attr("class","barbgclass").attr("x",e.x+.1*v).attr("y",e.y+.88*w).attr("width",B).attr("height",C).attr("fill-opacity",.2),i.items[a-1].size);f=f.toFixed(0);var k=i.items[a-1].size/8e6,b=(d.append("rect").attr("class","barfgclass").attr("x",e.x+.1*v).attr("y",e.y+.88*w).attr("width",k*B).attr("height",C).attr("fill-opacity",e.opacity),appendLineText(d,$.i18n.prop("svgSize")+": "+f+" Bytes",e.x+.12*v,e.y+.88*w+.7*C,B,.6*C));b.attr("class","blocktext"),d.append("title").text($.i18n.prop("svgSize")+": "+f+" Bytes");var x=t.append("g"),g=appendLineText(x,$.i18n.prop("svgTrans")+": "+i.items[a-1].transaction_count,e.x+.12*v,e.y+.765*w+.7*C,B,.8*C);return g.attr("class","blocktextblack"),x.append("title").text($.i18n.prop("svgTrans")+": "+i.items[a-1].transaction_count),t}function o(t,a,e,i){appendLineText(t,$.i18n.prop("svgHeight")+":1",e.x+.126*v,e.y+.48*w,.88*v,.1*w),appendLineText(t,$.i18n.prop("svgGenesisBlock"),e.x+.126*v,e.y+.7*w,.88*v,.1*w);return t}function r(t,a,e,i){appendChainText(t,i+$.i18n.prop("svgSecond"),a.x+.01*v,a.y-.01*w,.8*a.w,.8*a.h).append("title").text($.i18n.prop("svgTimeDiff")+"ï¼š"+i+$.i18n.prop("svgSecond")+"; "+$.i18n.prop("svgPreviousBlockHash")+":"+e);return t}function n(t,a,e,i){return t.append("path").attr("stroke-dasharray",z).attr("d",function(){var t=a.x+v+.01*v,s=a.y+.52*w,l=g(i.items[e].time_diff_lastblock)-.02*v,o="M"+t+" "+s+" l"+l+" 0";return o}),t}function c(t,a,e,i){return t.append("path").attr("stroke-dasharray",z).attr("d",function(){var t=a.x+.5*v,s=a.y,l=g(i.items[e].time_diff_lastblock)-.02*v,o=s-l,r="M"+t+" "+s+" L"+t+" "+o;return r}),t}function h(t,a,e,i){return t.append("path").attr("stroke-dasharray",z).attr("d",function(){var t=a.x,s=a.y+.52*w,l=g(i.items[e].time_diff_lastblock)-.02*v,o=t-l,r="M"+t+" "+s+" L"+o+" "+s;return r}),t}var p=UrlParam.param("fromheight"),m=UrlParam.param("fromdate");if(void 0===p)p=0;else try{p=parseInt(p),isNaN(p)&&(p=0)}catch(t){p=0}if(void 0===m)m="";else try{var d=/^[2][0][0-9]{2}-[0-1]{1}[0-9]{1}-[0-3]{1}[0-9]{1}$/,f=new RegExp(d);f.test(m)||(m="")}catch(t){m=""}m="2019-06-12";var k,b,_=p;if(0==datasource?b={ajaxBlockcount:"/jsondata/indexnew.json",ajaxsvgdata:"/jsondata/indexlimit6.json",ajaxtjs30:"/jsondata/transactionNums.json"}:(b={ajaxBlockcount:weburl+"/silkchain/indexnew",ajaxsvgdata:"/jsondata/indexlimit6.json",ajaxtjs30:weburl+"/silkchain/statistics/transactions?days=90"},p>0&&(b.ajaxsvgdata="/jsondata/indexlimit6.json"),m.length>0&&(b.ajaxtjs30=weburl+"/silkchain/statistics/transactions?days=90&fromdate="+m)),t(),p>0);else{var x=io(webhost);x.on("connect",function(){x.emit("subscribe","silubiumd/hashblock")}),x.on("silubiumd/hashblock",function(a){setTimeout(t,5e3)})}var g,y=$("#d3layout").width(),u={top:0,right:.02*y,bottom:.01*y,left:.005*y},v=(y-u.left-u.right)/7.5,w=1.2974*v,j=4*w,T=.6*v,L=.2*v,B=.8*v,C=.07*w,H=.38*v,M=.24*w,P=.012*v,z=P+","+P,S=d3.select("#d3layout").append("svg").attr("width",y).attr("height",j).attr("transform","translate(0,"+.03*w+")"),E=S.append("g").attr("class","mainClass"),I=d3.select("#d3tjb").append("svg").attr("width",y).attr("height",1.4*w).attr("transform","translate("+u.left+",0)"),N=(I.append("g").attr("class","tjbClass"),{left:u.left,top:u.top+j}),R={width:y-.576*v,x:N.left+.14*v,y:1.22*w};R.x,R.y,R.width});