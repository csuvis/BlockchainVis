$(function(){function t(t){$.ajax({type:"get",async:!0,url:t,success:function(t){$("#s_lastestheight").html(t.height),$("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show()},error:function(t){console.log(t.statusText)}})}function e(t){$("#detailTable").mask(),$("#coin_glyph").mask(),$("#coin_filter").mask(),$("#listTable").mask(),$.ajax({type:"get",async:!0,url:t,success:function(t){t.height>1e4&&t.txs.shift(),$(".moreshow").addClass("tt");var e=!0;$("#optionsRadios1").on("click",function(){e?($(".moreshow").removeClass("tt"),e=!1):($(".moreshow").addClass("tt"),e=!0)}),t.max_txsize,x=t.max_vin_count,g=t.max_vout_count;var o=Math.max.apply(Math,t.txs.map(function(t){return t.vin_count})),i=Math.min.apply(Math,t.txs.map(function(t){return t.vin_count})),s=Math.max.apply(Math,t.txs.map(function(t){return t.vout_count})),r=Math.min.apply(Math,t.txs.map(function(t){return t.vout_count}));b=Math.max.apply(Math,t.txs.map(function(t){return t.txfee})),u=Math.max(o,s),Math.min(i,r);Math.max(x,g);d3.scaleLinear().domain([0,1.5*u]).range([.02*Math.PI,Math.PI]),d3.scaleLinear().domain([0,b]).range([.5,1]),a(t),$("#detailTable").unmask(),n(t.txs),$("#listTable").unmask(),t},error:function(t){console.error(t.statusText)}})}function a(t){$("#block").text(t.height),$("#blockheight").text(t.height),$("#previousblockhash").attr("href","/block/blockhash.html?hash="+t.previousblockhash),$("#nextblockhash").attr("href","/block/blockhash.html?hash="+t.nextblockhash),$("#blockhash").text(t.hash),$("#blocktime").text(cnen_timeformater(t.time)),$("#blockminedby").text(t.miner),$("#blockreward").text(t.reward+" SLU"),$("#blocktxsfee").text(t.txfee_sum+" SLU"),$("#blocksize").text(t.size+" bytes"),$("#blockversion").text(parseInt(t.version).toString(16)),$("#blockconfirmations").text(t.confirmations)}function n(t){$("#listTable").bootstrapTable("destroy"),$("#listTable").bootstrapTable({data:t,pagination:!0,sortable:!0,columns:[{field:"txid",title:$.i18n.prop("bt-txid"),align:"center",formatter:function(t,e,a){var n="<a href='/transaction/txid.html?txid="+t+"'>"+t+"</a>";return n}},{field:"vin_count",title:$.i18n.prop("bt-vin_count"),align:"center",sortable:!0},{field:"vout_count",title:$.i18n.prop("bt-vout_count"),align:"center",sortable:!0},{field:"size",title:$.i18n.prop("bt-size"),align:"center",sortable:!0},{field:"txfee",title:$.i18n.prop("bt-txfee"),align:"center",sortable:!0}]})}var o,i=UrlParam.param("hash");if(void 0===i||64!=i.length){var s=GetUrlRelativePath();if(checkHash(s)){var r=s.split("/");i=r[2]}else{var l=$.i18n.prop("BlockHashinvalid");top.location.href="/info.html?message="+encodeURIComponent(l)}}o=0==datasource?{url:"/jsondata/blockhash.json",newblock:"/jsondata/indexnew.json"}:{url:weburl+"/silkchain/block/"+i,newblock:weburl+"/silkchain/indexnew"},testArray.blockhash.indexOf(i)>=0&&(o.url="/jsontest/blockhash/"+i+".json"),centw=window.innerWidth;var h={top:.01*centw,right:.01*centw,bottom:.01*centw,left:.01*centw},c=$("#coin_glyph").width(),d=.2*c<100?100:.2*c,f=(c-h.left-h.right)/7.5,p=1.2974*f;left_svg_w=.38*f*2,left_svg_h=.24*p*.88*2;$("#coin_radio").height(),left_svg_h;var m=c-left_svg_w-.6*h.left;d3.select("#coin_glyph").append("svg").attr("width",.8*left_svg_w).attr("height",left_svg_h).attr("transform","translate("+.6*h.left+",10)").attr("class","mainsvg_block"),d3.select("#coin_glyph").append("svg").attr("width",m).attr("height",left_svg_h).attr("transform","translate(10,10)"),d3.select("#coin_filter").append("svg").attr("width",.32*c).attr("height",.5*d).attr("transform","translate(0,"+h.left+")"),d3.select("#coin_filter").append("svg").attr("width",.32*c).attr("height",.5*d).attr("transform","translate("+.37*c+","+h.left+")"),d3.select("#coin_filter").append("svg").attr("width",.32*c).attr("height",.5*d).attr("transform","translate("+.296*-c+","+h.left+")");t(o.newblock),e(o.url);var u,b,x,g;$("#showhideBtn").bind("click",function(){var t=$("#showhideBtn").text();"显示"==t||"Show"==t?($("#showhideBtn").text($.i18n.prop("btn-hide")),$("#showhideDiv").show()):($("#showhideBtn").text($.i18n.prop("btn-show")),$("#showhideDiv").hide())})});